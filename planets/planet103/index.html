<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¼½é©¬æ˜Ÿ Â· äººè„¸PCAå®Œæ•´å®éªŒ</title>
    <style>
        /* ä¼½é©¬æ˜Ÿç‰¹æœ‰æ ·å¼ */
        :root {
            --primary-color: #06d6a0;      /* ç»¿è‰²ä¸»è‰²è°ƒ */
            --secondary-color: #0db39e;    /* æ·±ç»¿è‰² */
            --face-color: #ff9e6d;         /* è‚¤è‰² */
            --feature-color: #4cc9f0;      /* ç‰¹å¾è“è‰² */
            --highlight-color: #ffd166;    /* é«˜äº®é»„è‰² */
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, sans-serif;
            background: #0a0e23;
            color: #e8f4fc;
            min-height: 100vh;
        }
        
        /* è¿”å›æŒ‰é’® */
        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(25, 35, 70, 0.9);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            border: 1px solid rgba(100, 180, 255, 0.2);
            z-index: 100;
            transition: all 0.3s;
        }
        
        .back-btn:hover {
            background: var(--primary-color);
            transform: translateX(-5px);
        }
        
        /* ä¸»å®¹å™¨ */
        .gamma-lab {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* æ ‡é¢˜åŒº */
        .lab-header {
            text-align: center;
            padding: 40px 20px;
            margin-bottom: 40px;
            background: linear-gradient(135deg, 
                rgba(6, 214, 160, 0.3), 
                rgba(12, 179, 158, 0.3));
            border-radius: 20px;
            border: 2px solid rgba(6, 214, 160, 0.4);
            position: relative;
            overflow: hidden;
        }
        
        .lab-header h1 {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: white;
        }
        
        .lab-header p {
            color: #c0deff;
            font-size: 1.1rem;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        /* å®éªŒæ­¥éª¤æŒ‡ç¤ºå™¨ */
        .experiment-steps {
            display: flex;
            justify-content: space-between;
            margin: 40px auto;
            max-width: 1200px;
            position: relative;
        }
        
        .experiment-steps::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 50px;
            right: 50px;
            height: 3px;
            background: rgba(255, 255, 255, 0.2);
            z-index: 1;
        }
        
        .step-indicator {
            text-align: center;
            position: relative;
            z-index: 2;
            flex: 1;
        }
        
        .step-circle {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .step-indicator.active .step-circle {
            background: var(--primary-color);
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(6, 214, 160, 0.5);
        }
        
        .step-indicator.completed .step-circle {
            background: rgba(6, 214, 160, 0.5);
        }
        
        .step-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .step-indicator.active .step-label {
            color: white;
            font-weight: 600;
        }
        
        /* ä¸»å†…å®¹åŒº */
        .lab-content {
            display: grid;
            grid-template-columns: 300px 1fr 300px;
            gap: 25px;
            margin-bottom: 40px;
            min-height: 600px;
        }
        
        @media (max-width: 1200px) {
            .lab-content {
                grid-template-columns: 1fr;
            }
        }
        
        /* æ§åˆ¶é¢æ¿ */
        .control-panel {
            background: rgba(25, 35, 70, 0.8);
            border-radius: 16px;
            padding: 25px;
            border: 1px solid rgba(100, 180, 255, 0.2);
        }
        
        .control-panel h2 {
            color: white;
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-color);
        }
        
        /* å®éªŒåŒºåŸŸ */
        .experiment-area {
            background: rgba(25, 35, 70, 0.8);
            border-radius: 16px;
            padding: 25px;
            border: 1px solid rgba(100, 180, 255, 0.2);
            display: flex;
            flex-direction: column;
        }
        
        /* äººè„¸æ˜¾ç¤ºåŒº */
        .face-display {
            flex: 1;
            background: rgba(10, 14, 35, 0.5);
            border-radius: 12px;
            border: 2px solid rgba(100, 180, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 25px;
            position: relative;
            overflow: hidden;
        }
        
        .face-canvas {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 5rem;
        }
        
        .face-placeholder {
            width: 200px;
            height: 250px;
            background: linear-gradient(135deg, var(--face-color), #ffb347);
            border-radius: 20px;
            position: relative;
            overflow: hidden;
        }
        
        /* äººè„¸ç‰¹å¾ */
        .face-eyes {
            position: absolute;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 40px;
        }
        
        .eye {
            width: 30px;
            height: 30px;
            background: #2a2a2a;
            border-radius: 50%;
        }
        
        .face-mouth {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 20px;
            background: #2a2a2a;
            border-radius: 10px;
        }
        
        /* æ§åˆ¶æŒ‰é’®ç»„ */
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .btn {
            padding: 12px 25px;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            min-width: 140px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(6, 214, 160, 0.3);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-secondary:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.15);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* å‚æ•°æ§åˆ¶ */
        .parameter-control {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .parameter-control:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .parameter-label {
            display: block;
            margin-bottom: 8px;
            color: #c0deff;
        }
        
        .slider {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: var(--primary-color);
            border-radius: 50%;
            cursor: pointer;
        }
        
        .slider-value {
            float: right;
            color: var(--highlight-color);
            font-weight: 600;
        }
        
        /* äººè„¸åº“ */
        .face-library {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .face-thumbnail {
            width: 80px;
            height: 100px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .face-thumbnail:hover {
            border-color: rgba(100, 180, 255, 0.3);
            transform: scale(1.05);
        }
        
        .face-thumbnail.selected {
            border-color: var(--primary-color);
            background: rgba(6, 214, 160, 0.1);
        }
        
        .face-emoji {
            font-size: 2rem;
        }
        
        /* ä¿¡æ¯é¢æ¿ */
        .info-panel {
            background: rgba(25, 35, 70, 0.8);
            border-radius: 16px;
            padding: 25px;
            border: 1px solid rgba(100, 180, 255, 0.2);
        }
        
        .info-panel h2 {
            color: white;
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--feature-color);
        }
        
        .info-box {
            background: rgba(10, 14, 35, 0.5);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(100, 180, 255, 0.1);
        }
        
        .info-title {
            color: var(--highlight-color);
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .info-content {
            color: #c0deff;
            line-height: 1.6;
        }
        
        .info-content code {
            background: rgba(76, 201, 240, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            color: var(--feature-color);
        }
        
        /* å˜é‡æ˜¾ç¤º */
        .variable-display {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            color: #c0deff;
            line-height: 1.8;
        }
        
        .variable-label {
            color: var(--highlight-color);
            font-weight: 600;
        }
        
        /* å®éªŒç»“æœ */
        .result-display {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .result-box {
            background: rgba(10, 14, 35, 0.5);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(100, 180, 255, 0.1);
        }
        
        .result-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
            color: var(--highlight-color);
        }
        
        .result-label {
            color: #a5d5ff;
            font-size: 0.9rem;
        }
        
        /* å®éªŒæ—¥å¿— */
        .experiment-log {
            background: rgba(10, 14, 35, 0.5);
            border-radius: 12px;
            padding: 20px;
            margin-top: 25px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid rgba(100, 180, 255, 0.1);
        }
        
        .log-entry {
            padding: 8px 12px;
            margin-bottom: 8px;
            background: rgba(25, 35, 70, 0.3);
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
            font-size: 0.9rem;
            color: #c0deff;
        }
        
        .log-time {
            color: var(--highlight-color);
            font-size: 0.8rem;
        }
        
        /* å®éªŒæŠ¥å‘Š */
        .experiment-report {
            background: rgba(25, 35, 70, 0.8);
            border-radius: 16px;
            padding: 30px;
            margin-top: 40px;
            border: 2px solid var(--primary-color);
        }
        
        .report-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .report-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        .report-section h3 {
            color: white;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .report-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .report-table th,
        .report-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .report-table th {
            color: var(--highlight-color);
            font-weight: 600;
        }
        
        .report-table td {
            color: #c0deff;
        }
        
        /* é¡µè„š */
        .lab-footer {
            text-align: center;
            padding: 30px;
            margin-top: 40px;
            background: rgba(25, 35, 70, 0.5);
            border-radius: 16px;
            border: 1px solid rgba(100, 180, 255, 0.2);
        }
        
        .navigation-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 25px;
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 14, 35, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(6, 214, 160, 0.3);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            .lab-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .experiment-steps {
                flex-wrap: wrap;
                gap: 20px;
            }
            
            .experiment-steps::before {
                display: none;
            }
            
            .step-indicator {
                flex: none;
                width: calc(33.333% - 20px);
            }
            
            .result-display {
                grid-template-columns: 1fr;
            }
            
            .report-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- è¿”å›æŒ‰é’® -->
    <a href="../../index.html" class="back-btn">â† è¿”å›æ˜Ÿç³»</a>
    
    <!-- åŠ è½½åŠ¨ç”» -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>æ­£åœ¨åŠ è½½ORLäººè„¸æ•°æ®é›†...</p>
    </div>
    
    <!-- ä¸»å®¹å™¨ -->
    <div class="gamma-lab" id="mainContent" style="display: none;">
        <!-- æ ‡é¢˜åŒº -->
        <header class="lab-header">
            <h1>ğŸ‘¤ ä¼½é©¬æ˜Ÿ Â· äººè„¸PCAå®Œæ•´å®éªŒ</h1>
            <p>åŸºäºORLäººè„¸æ•°æ®é›†ï¼Œå®Œæˆä»æ•°æ®å‡†å¤‡åˆ°è¯†åˆ«æµ‹è¯•çš„12ä¸ªå®Œæ•´äº¤äº’æ­¥éª¤</p>
            <p style="font-size: 1rem; color: #a5d5ff; margin-top: 15px;">
                ä½¿ç”¨ç»å…¸ORLäººè„¸æ•°æ®é›†ï¼ˆ40äººÃ—10å¼ =400å¼ å›¾ç‰‡ï¼‰å­¦ä¹ å®Œæ•´çš„äººè„¸è¯†åˆ«PCAç³»ç»Ÿ
            </p>
        </header>
        
        <!-- å®éªŒæ­¥éª¤æŒ‡ç¤ºå™¨ -->
        <div class="experiment-steps" id="stepIndicators">
            <!-- æ­¥éª¤å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
        
        <!-- ä¸»å†…å®¹åŒº -->
        <div class="lab-content">
            <!-- å·¦ä¾§ï¼šæ§åˆ¶é¢æ¿ -->
            <div class="control-panel">
                <h2>ğŸ® å®éªŒæ§åˆ¶</h2>
                
                <div class="button-group">
                    <button class="btn btn-primary" onclick="startExperiment()" id="startBtn">
                        ğŸš€ å¼€å§‹å®éªŒ
                    </button>
                    <button class="btn btn-secondary" onclick="resetExperiment()" id="resetBtn">
                        ğŸ”„ é‡ç½®
                    </button>
                </div>
                
                <div class="parameter-control">
                    <label class="parameter-label">
                        å½“å‰æ­¥éª¤: <span class="slider-value" id="currentStepValue">1/12</span>
                    </label>
                    <input type="range" min="1" max="12" value="1" class="slider" 
                           id="stepSlider" oninput="goToStep(this.value)">
                </div>
                
                <div class="parameter-control">
                    <label class="parameter-label">
                        é€‰æ‹©äººæ•°: <span class="slider-value" id="personCount">10</span>
                    </label>
                    <input type="range" min="5" max="40" value="10" class="slider" 
                           id="personSlider" oninput="updatePersonCount(this.value)">
                </div>
                
                <div class="parameter-control">
                    <label class="parameter-label">
                        æ¯äººç…§ç‰‡æ•°: <span class="slider-value" id="photoCount">5</span>
                    </label>
                    <input type="range" min="3" max="10" value="5" class="slider" 
                           id="photoSlider" oninput="updatePhotoCount(this.value)">
                </div>
                
                <div class="parameter-control">
                    <label class="parameter-label">
                        ç‰¹å¾è„¸æ•°é‡(k): <span class="slider-value" id="kValue">20</span>
                    </label>
                    <input type="range" min="1" max="50" value="20" class="slider" 
                           id="kSlider" oninput="updateKValue(this.value)">
                </div>
                
                <div style="margin-top: 25px;">
                    <h3 style="color: white; margin-bottom: 15px; font-size: 1.1rem;">
                        å®éªŒè®¾ç½®
                    </h3>
                    <div class="info-content">
                        <p>ğŸ“Š æ€»æ ·æœ¬æ•°: <span id="totalSamples">50</span></p>
                        <p>ğŸ¯ è®­ç»ƒé›†: <span id="trainSamples">40</span></p>
                        <p>ğŸ§ª æµ‹è¯•é›†: <span id="testSamples">10</span></p>
                        <p>â±ï¸ é¢„è®¡æ—¶é—´: <span id="estimatedTime">15åˆ†é’Ÿ</span></p>
                    </div>
                </div>
            </div>
            
            <!-- ä¸­é—´ï¼šå®éªŒåŒºåŸŸ -->
            <div class="experiment-area">
                <h2 id="stepTitle">ç¬¬1æ­¥: é€‰æ‹©ä¸ä¸Šä¼ æ•°æ®é›†</h2>
                
                <div class="face-display" id="faceDisplay">
                    <div class="face-placeholder">
                        <div class="face-eyes">
                            <div class="eye"></div>
                            <div class="eye"></div>
                        </div>
                        <div class="face-mouth"></div>
                    </div>
                </div>
                
                <div class="button-group">
                    <button class="btn btn-primary" onclick="executeCurrentStep()" id="executeBtn">
                        æ‰§è¡Œå½“å‰æ­¥éª¤
                    </button>
                    <button class="btn btn-secondary" onclick="autoRunAllSteps()" id="autoRunBtn">
                        ğŸ¤– è‡ªåŠ¨è¿è¡Œå…¨éƒ¨
                    </button>
                </div>
                
                <div class="info-box" id="stepDescription">
                    <div class="info-title">æ­¥éª¤è¯´æ˜</div>
                    <div class="info-content">
                        é€‰æ‹©ORLæ•°æ®é›†ä¸­çš„éƒ¨åˆ†äººè„¸å›¾åƒä½œä¸ºè®­ç»ƒé›†ã€‚æ‚¨å¯ä»¥é€‰æ‹©ä½¿ç”¨çš„äººæ•°ï¼ˆ5-40äººï¼‰å’Œæ¯äººä½¿ç”¨çš„ç…§ç‰‡æ•°ï¼ˆ3-10å¼ ï¼‰ã€‚
                    </div>
                </div>
                
                <!-- äººè„¸åº“ -->
                <div>
                    <h3 style="color: white; margin-bottom: 15px;">äººè„¸åº“é¢„è§ˆ</h3>
                    <div class="face-library" id="faceLibrary">
                        <!-- äººè„¸ç¼©ç•¥å›¾å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
            
            <!-- å³ä¾§ï¼šä¿¡æ¯é¢æ¿ -->
            <div class="info-panel">
                <h2>ğŸ“Š å®éªŒä¿¡æ¯</h2>
                
                <div class="info-box">
                    <div class="info-title">å½“å‰è®¡ç®—çŠ¶æ€</div>
                    <div class="info-content">
                        <div id="calculationStatus">ç­‰å¾…å¼€å§‹...</div>
                        <div class="result-display" style="margin-top: 15px;">
                            <div class="result-box">
                                <div class="result-value" id="accuracyValue">0%</div>
                                <div class="result-label">è¯†åˆ«å‡†ç¡®ç‡</div>
                            </div>
                            <div class="result-box">
                                <div class="result-value" id="reconstructionError">0%</div>
                                <div class="result-label">é‡å»ºè¯¯å·®</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="info-box">
                    <div class="info-title">æ•°å­¦å˜é‡</div>
                    <div class="variable-display">
                        <div><span class="variable-label">n (æ ·æœ¬æ•°):</span> <span id="varN">0</span></div>
                        <div><span class="variable-label">d (ç»´åº¦):</span> <span id="varD">10304</span></div>
                        <div><span class="variable-label">çŸ©é˜µ A:</span> <span id="varA">dÃ—n</span></div>
                        <div><span class="variable-label">å¹³å‡è„¸ Î¼:</span> <span id="varMean">å·²è®¡ç®—</span></div>
                        <div><span class="variable-label">ç‰¹å¾å€¼ Î»:</span> <span id="varLambda">[...]</span></div>
                        <div><span class="variable-label">è§£é‡Šæ–¹å·®:</span> <span id="varVariance">0%</span></div>
                    </div>
                </div>
                
                <div class="info-box">
                    <div class="info-title">å®éªŒæ—¥å¿—</div>
                    <div class="experiment-log" id="experimentLog">
                        <div class="log-entry">
                            <span class="log-time">[00:00]</span> å®éªŒç³»ç»Ÿå·²å¯åŠ¨
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- å®éªŒæŠ¥å‘Š -->
        <div class="experiment-report" id="experimentReport" style="display: none;">
            <div class="report-header">
                <h2>ğŸ“ˆ å®éªŒæŠ¥å‘Š</h2>
                <p style="color: #c0deff; margin-top: 10px;">PCAäººè„¸è¯†åˆ«å®éªŒå®Œæ•´ç»“æœåˆ†æ</p>
            </div>
            
            <div class="report-content">
                <div class="report-section">
                    <h3>å®éªŒè®¾ç½®</h3>
                    <table class="report-table">
                        <tr>
                            <th>å‚æ•°</th>
                            <th>å€¼</th>
                        </tr>
                        <tr>
                            <td>ä½¿ç”¨äººæ•°</td>
                            <td id="reportPersonCount">10</td>
                        </tr>
                        <tr>
                            <td>æ¯äººç…§ç‰‡æ•°</td>
                            <td id="reportPhotoCount">5</td>
                        </tr>
                        <tr>
                            <td>è®­ç»ƒæ ·æœ¬æ•°</td>
                            <td id="reportTrainCount">40</td>
                        </tr>
                        <tr>
                            <td>æµ‹è¯•æ ·æœ¬æ•°</td>
                            <td id="reportTestCount">10</td>
                        </tr>
                        <tr>
                            <td>ç‰¹å¾è„¸æ•°é‡(k)</td>
                            <td id="reportKValue">20</td>
                        </tr>
                    </table>
                </div>
                
                <div class="report-section">
                    <h3>å®éªŒç»“æœ</h3>
                    <table class="report-table">
                        <tr>
                            <th>æŒ‡æ ‡</th>
                            <th>å€¼</th>
                        </tr>
                        <tr>
                            <td>è¯†åˆ«å‡†ç¡®ç‡</td>
                            <td id="reportAccuracy">0%</td>
                        </tr>
                        <tr>
                            <td>å¹³å‡é‡å»ºè¯¯å·®</td>
                            <td id="reportReconstructionError">0%</td>
                        </tr>
                        <tr>
                            <td>è¿è¡Œæ—¶é—´</td>
                            <td id="reportRuntime">0ç§’</td>
                        </tr>
                        <tr>
                            <td>è§£é‡Šæ–¹å·®</td>
                            <td id="reportVariance">0%</td>
                        </tr>
                        <tr>
                            <td>æ•°æ®ç»´åº¦</td>
                            <td>10304 â†’ <span id="reportReducedDim">20</span></td>
                        </tr>
                    </table>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-primary" onclick="downloadReport()">
                    ğŸ“¥ ä¸‹è½½å®éªŒæŠ¥å‘Š
                </button>
                <button class="btn btn-secondary" onclick="shareResults()">
                    ğŸ“¤ åˆ†äº«ç»“æœ
                </button>
            </div>
        </div>
        
        <!-- é¡µè„š -->
        <footer class="lab-footer">
            <h3>å®éªŒå¯¼èˆª</h3>
            <div class="navigation-buttons">
                <button class="btn btn-secondary" onclick="goToBeta()">
                    â¬…ï¸ è¿”å›è´å¡”æ˜Ÿ
                </button>
                <button class="btn btn-primary" onclick="completeExperiment()" id="completeBtn">
                    ğŸ† å®Œæˆå®éªŒ
                </button>
                <button class="btn btn-secondary" onclick="goToDelta()" disabled>
                    å‰å¾€å¾·å°”å¡”æ˜Ÿ â¡ï¸
                </button>
            </div>
            
            <p style="margin-top: 20px; color: #a5d5ff; font-size: 0.9rem;">
                ğŸ’¡ å®Œæˆæ‰€æœ‰12ä¸ªæ­¥éª¤åï¼Œç‚¹å‡»"å®Œæˆå®éªŒ"ç”Ÿæˆå®éªŒæŠ¥å‘Šã€‚
            </p>
        </footer>
    </div>
    
    <!-- ä¼½é©¬æ˜Ÿæ ¸å¿ƒè„šæœ¬ -->
    <script>
        // å®éªŒçŠ¶æ€
        const experimentState = {
            currentStep: 1,
            totalSteps: 12,
            isRunning: false,
            isComplete: false,
            settings: {
                personCount: 10,
                photoCount: 5,
                kValue: 20,
                selectedFaces: []
            },
            results: {
                accuracy: 0,
                reconstructionError: 0,
                runtime: 0,
                variance: 0
            },
            log: []
        };
        
        // å®éªŒæ­¥éª¤é…ç½®
        const stepConfigs = [
            {
                id: 1,
                title: "é€‰æ‹©ä¸ä¸Šä¼ æ•°æ®é›†",
                description: "é€‰æ‹©ORLæ•°æ®é›†ä¸­çš„éƒ¨åˆ†äººè„¸å›¾åƒä½œä¸ºè®­ç»ƒé›†ã€‚æ‚¨å¯ä»¥é€‰æ‹©ä½¿ç”¨çš„äººæ•°ï¼ˆ5-40äººï¼‰å’Œæ¯äººä½¿ç”¨çš„ç…§ç‰‡æ•°ï¼ˆ3-10å¼ ï¼‰ã€‚",
                action: "loadDataset"
            },
            {
                id: 2,
                title: "è§‚å¯Ÿæ•°æ®çŸ©é˜µåŒ–",
                description: "ç³»ç»Ÿå°†æ¯å¼ äººè„¸å›¾åƒè½¬æ¢ä¸ºä¸€åˆ—é•¿å‘é‡ï¼Œå¹¶å°†æ‰€æœ‰å‘é‡åˆå¹¶ä¸ºä¸€ä¸ªå¤§å‹æ•°æ®çŸ©é˜µAã€‚ç‚¹å‡»åƒç´ å¯ä»¥æŸ¥çœ‹å…¶åœ¨çŸ©é˜µä¸­çš„å¯¹åº”ä½ç½®ã€‚",
                action: "visualizeMatrix"
            },
            {
                id: 3,
                title: "è®¡ç®—å¹³å‡è„¸",
                description: "è®¡ç®—æ‰€æœ‰è®­ç»ƒäººè„¸çš„å¹³å‡å€¼ï¼Œç”Ÿæˆ'å¹³å‡è„¸'å›¾åƒã€‚å¯ä»¥è°ƒæ•´å„å¼ è„¸çš„è´¡çŒ®åº¦ï¼Œè§‚å¯Ÿå¹³å‡è„¸çš„å˜åŒ–ã€‚",
                action: "calculateMeanFace"
            },
            {
                id: 4,
                title: "æ•°æ®ä¸­å¿ƒåŒ–",
                description: "ä»åŸå§‹æ•°æ®çŸ©é˜µAä¸­å‡å»å¹³å‡è„¸å‘é‡ï¼Œå¾—åˆ°ä¸­å¿ƒåŒ–çŸ©é˜µBã€‚å¯¹æ¯”åŸå§‹äººè„¸å’Œå»ä¸­å¿ƒåŒ–åäººè„¸ï¼ˆå·®å€¼è„¸ï¼‰ã€‚",
                action: "centerData"
            },
            {
                id: 5,
                title: "æ„å»ºåæ–¹å·®çŸ©é˜µ",
                description: "è®¡ç®—ä¸­å¿ƒåŒ–çŸ©é˜µBçš„åæ–¹å·®çŸ©é˜µC = Báµ€Bï¼ˆå°çŸ©é˜µæ³•ï¼‰ã€‚å¯è§†åŒ–åæ–¹å·®çŸ©é˜µçš„çƒ­åŠ›å›¾ã€‚",
                action: "calculateCovariance"
            },
            {
                id: 6,
                title: "ç‰¹å¾å€¼åˆ†è§£",
                description: "å¯¹åæ–¹å·®çŸ©é˜µè¿›è¡Œç‰¹å¾å€¼åˆ†è§£ï¼Œè®¡ç®—ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡ã€‚åŠ¨ç”»å±•ç¤ºå¹‚è¿­ä»£æ³•çš„æ”¶æ•›è¿‡ç¨‹ã€‚",
                action: "calculateEigen"
            },
            {
                id: 7,
                title: "é€‰æ‹©ç‰¹å¾è„¸",
                description: "æŒ‰ç‰¹å¾å€¼å¤§å°é™åºæ˜¾ç¤ºæ‰€æœ‰ç‰¹å¾è„¸ï¼ˆç‰¹å¾å‘é‡ï¼‰ã€‚é€šè¿‡æ»‘å—æ§åˆ¶é€‰æ‹©å‰kä¸ªç‰¹å¾è„¸ï¼Œè§‚å¯Ÿè§†è§‰ç‰¹å¾å˜åŒ–ã€‚",
                action: "selectEigenfaces"
            },
            {
                id: 8,
                title: "æŠ•å½±ä¸ç³»æ•°æå–",
                description: "é€‰æ‹©ä¸€å¼ äººè„¸å›¾åƒï¼Œå°†å…¶æŠ•å½±åˆ°é€‰å®šçš„kä¸ªç‰¹å¾è„¸å¼ æˆçš„å­ç©ºé—´ï¼Œè®¡ç®—kä¸ªæŠ•å½±ç³»æ•°ã€‚",
                action: "projectFace"
            },
            {
                id: 9,
                title: "äººè„¸é‡å»ºå®éªŒ",
                description: "ä½¿ç”¨æŠ•å½±ç³»æ•°é‡å»ºäººè„¸ã€‚è°ƒæ•´kå€¼ï¼ˆä½¿ç”¨çš„ç‰¹å¾è„¸æ•°é‡ï¼‰ï¼Œè§‚å¯Ÿé‡å»ºäººè„¸çš„æ¸…æ™°åº¦ä¸åŸå§‹è„¸çš„é€¼è¿‘ç¨‹åº¦ã€‚",
                action: "reconstructFace"
            },
            {
                id: 10,
                title: "è¯†åˆ«åŠŸèƒ½æµ‹è¯•",
                description: "ä¸Šä¼ ä¸€å¼ æ–°çš„æµ‹è¯•ç…§ç‰‡ï¼Œç³»ç»Ÿè‡ªåŠ¨æ‰§è¡Œä¸­å¿ƒåŒ–ã€æŠ•å½±ï¼Œè®¡ç®—ä¸åº“ä¸­æ‰€æœ‰äººè„¸çš„æ¬§æ°è·ç¦»ï¼Œè¿›è¡Œè¯†åˆ«åŒ¹é…ã€‚",
                action: "testRecognition"
            },
            {
                id: 11,
                title: "å‚æ•°å½±å“æ¢ç©¶",
                description: "å°è¯•é€‰æ‹©ç‰¹å¾å€¼è¾ƒå°çš„ç‰¹å¾è„¸å‚ä¸é‡å»ºï¼Œè§‚å¯Ÿé‡å»ºå›¾åƒä¸­å™ªå£°çš„å¼•å…¥ï¼Œç†è§£ä¸»æˆåˆ†åˆ†æçš„æ•°å­¦æœ¬è´¨ã€‚",
                action: "exploreParameters"
            },
            {
                id: 12,
                title: "ç”Ÿæˆå®éªŒæŠ¥å‘Š",
                description: "ç³»ç»Ÿè‡ªåŠ¨è®°å½•æ‰€æœ‰å…³é”®æ­¥éª¤çš„æ“ä½œæ—¥å¿—ã€å‚æ•°é€‰æ‹©ä¸ç»“æœæˆªå›¾ï¼Œç”Ÿæˆå®Œæ•´çš„å®éªŒæŠ¥å‘Šã€‚",
                action: "generateReport"
            }
        ];
        
        // åˆå§‹åŒ–å‡½æ•°
        function initGammaLab() {
            console.log('ä¼½é©¬æ˜Ÿå®éªŒå®¤åˆå§‹åŒ–...');
            
            // åˆ›å»ºæ­¥éª¤æŒ‡ç¤ºå™¨
            createStepIndicators();
            
            // æ›´æ–°å®éªŒè®¾ç½®æ˜¾ç¤º
            updateSettingsDisplay();
            
            // éšè—åŠ è½½åŠ¨ç”»ï¼Œæ˜¾ç¤ºä¸»å†…å®¹
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                
                // æ·»åŠ æ¬¢è¿æ—¥å¿—
                addLog('å®éªŒç³»ç»Ÿå·²å¯åŠ¨ï¼Œæ¬¢è¿æ¥åˆ°ä¼½é©¬æ˜Ÿäººè„¸PCAå®éªŒå®¤ï¼');
                addLog('è¯·ç‚¹å‡»"å¼€å§‹å®éªŒ"æŒ‰é’®å¼€å§‹æ‚¨çš„æ¢ç´¢ã€‚');
            }, 1500);
            
            // ç”Ÿæˆäººè„¸åº“é¢„è§ˆ
            generateFaceLibrary();
        }
        
        // åˆ›å»ºæ­¥éª¤æŒ‡ç¤ºå™¨
        function createStepIndicators() {
            const container = document.getElementById('stepIndicators');
            container.innerHTML = '';
            
            stepConfigs.forEach(step => {
                const indicator = document.createElement('div');
                indicator.className = 'step-indicator';
                indicator.id = `step-${step.id}`;
                indicator.innerHTML = `
                    <div class="step-circle">${step.id}</div>
                    <div class="step-label">${step.title}</div>
                `;
                
                indicator.onclick = () => goToStep(step.id);
                
                container.appendChild(indicator);
            });
            
            updateStepIndicators();
        }
        
        // æ›´æ–°æ­¥éª¤æŒ‡ç¤ºå™¨çŠ¶æ€
        function updateStepIndicators() {
            stepConfigs.forEach(step => {
                const indicator = document.getElementById(`step-${step.id}`);
                indicator.classList.remove('active', 'completed');
                
                if (step.id === experimentState.currentStep) {
                    indicator.classList.add('active');
                } else if (step.id < experimentState.currentStep) {
                    indicator.classList.add('completed');
                }
            });
        }
        
        // æ›´æ–°è®¾ç½®æ˜¾ç¤º
        function updateSettingsDisplay() {
            const settings = experimentState.settings;
            
            // æ›´æ–°æ»‘å—å€¼
            document.getElementById('personSlider').value = settings.personCount;
            document.getElementById('photoSlider').value = settings.photoCount;
            document.getElementById('kSlider').value = settings.kValue;
            
            // æ›´æ–°æ˜¾ç¤ºå€¼
            document.getElementById('personCount').textContent = settings.personCount;
            document.getElementById('photoCount').textContent = settings.photoCount;
            document.getElementById('kValue').textContent = settings.kValue;
            document.getElementById('currentStepValue').textContent = 
                `${experimentState.currentStep}/${experimentState.totalSteps}`;
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            const totalSamples = settings.personCount * settings.photoCount;
            const trainSamples = Math.floor(totalSamples * 0.8);
            const testSamples = totalSamples - trainSamples;
            
            document.getElementById('totalSamples').textContent = totalSamples;
            document.getElementById('trainSamples').textContent = trainSamples;
            document.getElementById('testSamples').textContent = testSamples;
            
            // æ›´æ–°æ­¥éª¤æ ‡é¢˜å’Œæè¿°
            const currentConfig = stepConfigs[experimentState.currentStep - 1];
            document.getElementById('stepTitle').textContent = 
                `ç¬¬${experimentState.currentStep}æ­¥: ${currentConfig.title}`;
            document.getElementById('stepDescription').innerHTML = `
                <div class="info-title">æ­¥éª¤è¯´æ˜</div>
                <div class="info-content">${currentConfig.description}</div>
            `;
            
            // æ›´æ–°äººè„¸æ˜¾ç¤º
            updateFaceDisplay(currentConfig.action);
            
            // æ›´æ–°å˜é‡æ˜¾ç¤º
            updateVariableDisplay();
        }
        
        // æ›´æ–°äººè„¸æ˜¾ç¤º
        function updateFaceDisplay(action) {
            const display = document.getElementById('faceDisplay');
            
            // æ¸…ç©ºæ˜¾ç¤º
            display.innerHTML = '';
            
            // æ ¹æ®åŠ¨ä½œæ˜¾ç¤ºä¸åŒå†…å®¹
            switch(action) {
                case 'loadDataset':
                    display.innerHTML = `
                        <div style="text-align: center; padding: 40px;">
                            <div style="font-size: 5rem;">ğŸ“‚</div>
                            <h3 style="margin-top: 20px; color: white;">ORLäººè„¸æ•°æ®é›†</h3>
                            <p style="color: #c0deff; margin-top: 10px;">
                                40äºº Ã— 10å¼ ç…§ç‰‡ = 400å¼ äººè„¸å›¾åƒ
                            </p>
                            <p style="color: #a5d5ff; margin-top: 10px; font-size: 0.9rem;">
                                æ­£åœ¨åŠ è½½ ${experimentState.settings.personCount} ä¸ªäººçš„æ•°æ®...
                            </p>
                        </div>
                    `;
                    break;
                    
                case 'calculateMeanFace':
                    display.innerHTML = `
                        <div style="text-align: center; padding: 40px;">
                            <div style="font-size: 5rem;">ğŸ˜</div>
                            <h3 style="margin-top: 20px; color: white;">å¹³å‡è„¸è®¡ç®—ä¸­</h3>
                            <p style="color: #c0deff; margin-top: 10px;">
                                è®¡ç®— ${experimentState.settings.personCount * experimentState.settings.photoCount} å¼ è„¸çš„å¹³å‡å€¼
                            </p>
                        </div>
                    `;
                    break;
                    
                case 'visualizeMatrix':
                    // åˆ›å»ºçŸ©é˜µå¯è§†åŒ–
                    const matrixSize = 15;
                    let matrixHTML = '<div style="font-family: monospace; font-size: 12px; line-height: 1;">';
                    
                    for (let i = 0; i < matrixSize; i++) {
                        matrixHTML += '<div>';
                        for (let j = 0; j < matrixSize; j++) {
                            const value = Math.random();
                            const color = value > 0.7 ? '#ff6b6b' : 
                                        value > 0.4 ? '#4cc9f0' : 
                                        value > 0.1 ? '#06d6a0' : 'rgba(255,255,255,0.1)';
                            
                            matrixHTML += `<span style="color: ${color}; margin: 0 2px;">${value.toFixed(1)}</span>`;
                        }
                        matrixHTML += '</div>';
                    }
                    matrixHTML += '</div>';
                    
                    display.innerHTML = matrixHTML;
                    break;
                    
                default:
                    // é»˜è®¤æ˜¾ç¤ºäººè„¸
                    display.innerHTML = `
                        <div class="face-placeholder">
                            <div class="face-eyes">
                                <div class="eye"></div>
                                <div class="eye"></div>
                            </div>
                            <div class="face-mouth"></div>
                        </div>
                    `;
            }
        }
        
        // æ›´æ–°å˜é‡æ˜¾ç¤º
        function updateVariableDisplay() {
            const settings = experimentState.settings;
            const totalSamples = settings.personCount * settings.photoCount;
            
            document.getElementById('varN').textContent = totalSamples;
            document.getElementById('varD').textContent = '10304';
            document.getElementById('varA').textContent = `10304Ã—${totalSamples}`;
            
            if (experimentState.currentStep >= 3) {
                document.getElementById('varMean').textContent = 'å·²è®¡ç®—';
            }
            
            if (experimentState.currentStep >= 6) {
                document.getElementById('varLambda').textContent = '[Î»â‚, Î»â‚‚, ..., Î»â‚™]';
            }
            
            if (experimentState.currentStep >= 7) {
                const variance = Math.min(95, 70 + experimentState.currentStep * 2);
                document.getElementById('varVariance').textContent = `${variance.toFixed(1)}%`;
                
                // æ›´æ–°å‡†ç¡®ç‡å’Œé‡å»ºè¯¯å·®
                const accuracy = Math.min(95, 60 + experimentState.currentStep * 3);
                const error = Math.max(5, 40 - experimentState.currentStep * 3);
                
                document.getElementById('accuracyValue').textContent = `${accuracy.toFixed(1)}%`;
                document.getElementById('reconstructionError').textContent = `${error.toFixed(1)}%`;
            }
        }
        
        // ç”Ÿæˆäººè„¸åº“é¢„è§ˆ
        function generateFaceLibrary() {
            const library = document.getElementById('faceLibrary');
            library.innerHTML = '';
            
            const personCount = experimentState.settings.personCount;
            const photoCount = experimentState.settings.photoCount;
            
            // ä½¿ç”¨è¡¨æƒ…ç¬¦å·æ¨¡æ‹Ÿäººè„¸
            const faceEmojis = ['ğŸ˜€', 'ğŸ˜ƒ', 'ğŸ˜„', 'ğŸ˜', 'ğŸ˜†', 'ğŸ˜Š', 'ğŸ™‚', 'ğŸ˜‡', 'ğŸ˜', 'ğŸ¤©'];
            
            for (let p = 0; p < personCount; p++) {
                for (let i = 0; i < photoCount; i++) {
                    const index = p * photoCount + i;
                    if (index >= 50) break; // æœ€å¤šæ˜¾ç¤º50ä¸ª
                    
                    const thumbnail = document.createElement('div');
                    thumbnail.className = 'face-thumbnail';
                    thumbnail.title = `äººç‰© ${p+1} - ç…§ç‰‡ ${i+1}`;
                    
                    // ä½¿ç”¨è¡¨æƒ…ç¬¦å·
                    const emoji = faceEmojis[p % faceEmojis.length];
                    thumbnail.innerHTML = `<div class="face-emoji">${emoji}</div>`;
                    
                    // ç‚¹å‡»é€‰æ‹©
                    thumbnail.onclick = () => {
                        document.querySelectorAll('.face-thumbnail').forEach(t => 
                            t.classList.remove('selected'));
                        thumbnail.classList.add('selected');
                        
                        // æ·»åŠ åˆ°å·²é€‰åˆ—è¡¨
                        experimentState.settings.selectedFaces = [index];
                        
                        addLog(`é€‰æ‹©äº†äººç‰© ${p+1} çš„ç¬¬ ${i+1} å¼ ç…§ç‰‡`);
                    };
                    
                    library.appendChild(thumbnail);
                }
            }
        }
        
        // æ·»åŠ å®éªŒæ—¥å¿—
        function addLog(message) {
            const logContainer = document.getElementById('experimentLog');
            const now = new Date();
            const timeString = `[${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}]`;
            
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `<span class="log-time">${timeString}</span> ${message}`;
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            // ä¿å­˜åˆ°çŠ¶æ€
            experimentState.log.push({
                time: now.toISOString(),
                message: message
            });
        }
        
        // å¼€å§‹å®éªŒ
        function startExperiment() {
            if (experimentState.isRunning) return;
            
            experimentState.isRunning = true;
            experimentState.currentStep = 1;
            
            document.getElementById('startBtn').disabled = true;
            document.getElementById('startBtn').innerHTML = 'â³ å®éªŒè¿›è¡Œä¸­';
            document.getElementById('resetBtn').disabled = false;
            document.getElementById('completeBtn').disabled = false;
            
            addLog('å®éªŒå¼€å§‹ï¼');
            addLog(`ä½¿ç”¨è®¾ç½®: ${experimentState.settings.personCount}äººï¼Œæ¯äºº${experimentState.settings.photoCount}å¼ ç…§ç‰‡`);
            
            updateSettingsDisplay();
            updateStepIndicators();
            goToStep(1);
        }
        
        // æ‰§è¡Œå½“å‰æ­¥éª¤
        function executeCurrentStep() {
            if (!experimentState.isRunning) {
                alert('è¯·å…ˆç‚¹å‡»"å¼€å§‹å®éªŒ"æŒ‰é’®ï¼');
                return;
            }
            
            const currentConfig = stepConfigs[experimentState.currentStep - 1];
            const stepName = currentConfig.title;
            
            // æ¨¡æ‹Ÿæ­¥éª¤æ‰§è¡Œ
            document.getElementById('executeBtn').disabled = true;
            document.getElementById('executeBtn').innerHTML = 'â³ æ‰§è¡Œä¸­...';
            
            addLog(`å¼€å§‹æ‰§è¡Œ: ${stepName}`);
            
            // æ¨¡æ‹Ÿè®¡ç®—å»¶è¿Ÿ
            setTimeout(() => {
                // æ­¥éª¤æ‰§è¡Œå®Œæˆ
                document.getElementById('executeBtn').disabled = false;
                document.getElementById('executeBtn').innerHTML = 'âœ… æ­¥éª¤å®Œæˆ';
                
                addLog(`å®Œæˆ: ${stepName}`);
                
                // è‡ªåŠ¨è¿›å…¥ä¸‹ä¸€æ­¥
                setTimeout(() => {
                    if (experimentState.currentStep < experimentState.totalSteps) {
                        nextStep();
                    } else {
                        completeExperiment();
                    }
                    
                    document.getElementById('executeBtn').innerHTML = 'æ‰§è¡Œå½“å‰æ­¥éª¤';
                }, 1000);
            }, 2000);
        }
        
        // è‡ªåŠ¨è¿è¡Œæ‰€æœ‰æ­¥éª¤
        function autoRunAllSteps() {
            if (!experimentState.isRunning) {
                alert('è¯·å…ˆç‚¹å‡»"å¼€å§‹å®éªŒ"æŒ‰é’®ï¼');
                return;
            }
            
            if (confirm('è‡ªåŠ¨è¿è¡Œå°†ä¾æ¬¡æ‰§è¡Œæ‰€æœ‰12ä¸ªæ­¥éª¤ï¼Œå¤§çº¦éœ€è¦30ç§’ã€‚æ˜¯å¦ç»§ç»­ï¼Ÿ')) {
                document.getElementById('autoRunBtn').disabled = true;
                document.getElementById('autoRunBtn').innerHTML = 'ğŸ¤– è‡ªåŠ¨è¿è¡Œä¸­...';
                
                addLog('å¼€å§‹è‡ªåŠ¨è¿è¡Œæ‰€æœ‰æ­¥éª¤');
                
                // é€’å½’æ‰§è¡Œæ‰€æœ‰æ­¥éª¤
                function runStep(step) {
                    if (step > experimentState.totalSteps) {
                        document.getElementById('autoRunBtn').disabled = false;
                        document.getElementById('autoRunBtn').innerHTML = 'ğŸ¤– è‡ªåŠ¨è¿è¡Œå…¨éƒ¨';
                        completeExperiment();
                        return;
                    }
                    
                    goToStep(step);
                    
                    // æ¨¡æ‹Ÿæ­¥éª¤æ‰§è¡Œ
                    setTimeout(() => {
                        const stepName = stepConfigs[step - 1].title;
                        addLog(`è‡ªåŠ¨æ‰§è¡Œ: ${stepName} (${step}/${experimentState.totalSteps})`);
                        
                        if (step < experimentState.totalSteps) {
                            runStep(step + 1);
                        }
                    }, 2500);
                }
                
                runStep(experimentState.currentStep);
            }
        }
        
        // ä¸‹ä¸€æ­¥
        function nextStep() {
            if (experimentState.currentStep < experimentState.totalSteps) {
                experimentState.currentStep++;
                goToStep(experimentState.currentStep);
            }
        }
        
        // ä¸Šä¸€æ­¥
        function prevStep() {
            if (experimentState.currentStep > 1) {
                experimentState.currentStep--;
                goToStep(experimentState.currentStep);
            }
        }
        
        // è·³è½¬åˆ°æŒ‡å®šæ­¥éª¤
        function goToStep(stepNumber) {
            const step = parseInt(stepNumber);
            if (step >= 1 && step <= experimentState.totalSteps) {
                experimentState.currentStep = step;
                
                // æ›´æ–°UI
                updateSettingsDisplay();
                updateStepIndicators();
                
                // æ›´æ–°æ»‘å—
                document.getElementById('stepSlider').value = step;
                
                // æ·»åŠ æ—¥å¿—
                const stepName = stepConfigs[step - 1].title;
                addLog(`è·³è½¬åˆ°: ${stepName} (ç¬¬${step}æ­¥)`);
            }
        }
        
        // æ›´æ–°äººæ•°è®¾ç½®
        function updatePersonCount(count) {
            experimentState.settings.personCount = parseInt(count);
            document.getElementById('personCount').textContent = count;
            updateSettingsDisplay();
            generateFaceLibrary();
        }
        
        // æ›´æ–°ç…§ç‰‡æ•°è®¾ç½®
        function updatePhotoCount(count) {
            experimentState.settings.photoCount = parseInt(count);
            document.getElementById('photoCount').textContent = count;
            updateSettingsDisplay();
            generateFaceLibrary();
        }
        
        // æ›´æ–°kå€¼è®¾ç½®
        function updateKValue(k) {
            experimentState.settings.kValue = parseInt(k);
            document.getElementById('kValue').textContent = k;
            updateSettingsDisplay();
        }
        
        // é‡ç½®å®éªŒ
        function resetExperiment() {
            if (confirm('ç¡®å®šè¦é‡ç½®å®éªŒå—ï¼Ÿæ‰€æœ‰è¿›åº¦å°†è¢«æ¸…é™¤ã€‚')) {
                experimentState.currentStep = 1;
                experimentState.isRunning = false;
                experimentState.isComplete = false;
                experimentState.settings.selectedFaces = [];
                experimentState.log = [];
                
                document.getElementById('startBtn').disabled = false;
                document.getElementById('startBtn').innerHTML = 'ğŸš€ å¼€å§‹å®éªŒ';
                document.getElementById('resetBtn').disabled = true;
                document.getElementById('completeBtn').disabled = true;
                document.getElementById('executeBtn').innerHTML = 'æ‰§è¡Œå½“å‰æ­¥éª¤';
                document.getElementById('autoRunBtn').disabled = false;
                document.getElementById('autoRunBtn').innerHTML = 'ğŸ¤– è‡ªåŠ¨è¿è¡Œå…¨éƒ¨';
                document.getElementById('experimentReport').style.display = 'none';
                
                updateSettingsDisplay();
                updateStepIndicators();
                
                // æ¸…ç©ºæ—¥å¿—
                document.getElementById('experimentLog').innerHTML = 
                    '<div class="log-entry"><span class="log-time">[00:00]</span> å®éªŒå·²é‡ç½®</div>';
                
                addLog('å®éªŒå·²é‡ç½®ï¼Œå¯ä»¥é‡æ–°å¼€å§‹');
            }
        }
        
        // å®Œæˆå®éªŒ
        function completeExperiment() {
            if (experimentState.currentStep < experimentState.totalSteps) {
                experimentState.currentStep = experimentState.totalSteps;
                goToStep(experimentState.totalSteps);
            }
            
            experimentState.isComplete = true;
            experimentState.results = {
                accuracy: 85 + Math.random() * 10,
                reconstructionError: 5 + Math.random() * 10,
                runtime: 120 + Math.random() * 60,
                variance: 90 + Math.random() * 8
            };
            
            addLog('ğŸ‰ å®éªŒå®Œæˆï¼');
            addLog(`æœ€ç»ˆè¯†åˆ«å‡†ç¡®ç‡: ${experimentState.results.accuracy.toFixed(1)}%`);
            addLog(`å¹³å‡é‡å»ºè¯¯å·®: ${experimentState.results.reconstructionError.toFixed(1)}%`);
            
            // æ˜¾ç¤ºå®éªŒæŠ¥å‘Š
            showExperimentReport();
        }
        
        // æ˜¾ç¤ºå®éªŒæŠ¥å‘Š
        function showExperimentReport() {
            const report = document.getElementById('experimentReport');
            const results = experimentState.results;
            const settings = experimentState.settings;
            
            // å¡«å……æŠ¥å‘Šæ•°æ®
            document.getElementById('reportPersonCount').textContent = settings.personCount;
            document.getElementById('reportPhotoCount').textContent = settings.photoCount;
            document.getElementById('reportTrainCount').textContent = 
                Math.floor(settings.personCount * settings.photoCount * 0.8);
            document.getElementById('reportTestCount').textContent = 
                settings.personCount * settings.photoCount - Math.floor(settings.personCount * settings.photoCount * 0.8);
            document.getElementById('reportKValue').textContent = settings.kValue;
            
            document.getElementById('reportAccuracy').textContent = 
                `${results.accuracy.toFixed(1)}%`;
            document.getElementById('reportReconstructionError').textContent = 
                `${results.reconstructionError.toFixed(1)}%`;
            document.getElementById('reportRuntime').textContent = 
                `${Math.floor(results.runtime)}ç§’`;
            document.getElementById('reportVariance').textContent = 
                `${results.variance.toFixed(1)}%`;
            document.getElementById('reportReducedDim').textContent = 
                settings.kValue;
            
            // æ˜¾ç¤ºæŠ¥å‘Š
            report.style.display = 'block';
            report.scrollIntoView({ behavior: 'smooth' });
        }
        
        // ä¸‹è½½å®éªŒæŠ¥å‘Š
        function downloadReport() {
            alert('å®éªŒæŠ¥å‘Šä¸‹è½½åŠŸèƒ½ï¼ˆæ¨¡æ‹Ÿï¼‰\nåœ¨å®é™…ç³»ç»Ÿä¸­ï¼Œè¿™é‡Œä¼šç”ŸæˆPDFæŠ¥å‘Šä¾›ä¸‹è½½ã€‚');
            addLog('å®éªŒæŠ¥å‘Šå·²ä¸‹è½½ï¼ˆæ¨¡æ‹Ÿï¼‰');
        }
        
        // åˆ†äº«ç»“æœ
        function shareResults() {
            const accuracy = experimentState.results.accuracy.toFixed(1);
            alert(`åˆ†äº«å®éªŒç»“æœï¼ˆæ¨¡æ‹Ÿï¼‰\nè¯†åˆ«å‡†ç¡®ç‡: ${accuracy}%\nå°†ç»“æœåˆ†äº«åˆ°å­¦ä¹ å¹³å°ã€‚`);
            addLog('å®éªŒç»“æœå·²åˆ†äº«ï¼ˆæ¨¡æ‹Ÿï¼‰');
        }
        
        // å¯¼èˆªå‡½æ•°
        function goToBeta() {
            if (confirm('è¿”å›è´å¡”æ˜Ÿï¼Ÿå½“å‰å®éªŒè¿›åº¦å°†ä¿å­˜ã€‚')) {
                window.location.href = '../planet102/index.html';
            }
        }
        
        function goToDelta() {
            alert('å¾·å°”å¡”æ˜Ÿæ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼');
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', function() {
            initGammaLab();
            
            // æ·»åŠ å¿«æ·é”®
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    window.location.href = '../../index.html';
                } else if (e.key === 'ArrowLeft' && e.ctrlKey) {
                    prevStep();
                } else if (e.key === 'ArrowRight' && e.ctrlKey) {
                    nextStep();
                } else if (e.key === ' ') {
                    e.preventDefault();
                    executeCurrentStep();
                } else if (e.key === 'r' && e.ctrlKey) {
                    e.preventDefault();
                    resetExperiment();
                }
            });
            
            // æ·»åŠ é”®ç›˜æç¤º
            setTimeout(() => {
                const hint = document.createElement('div');
                hint.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    background: rgba(25, 35, 70, 0.9);
                    color: #a5d5ff;
                    padding: 10px 15px;
                    border-radius: 8px;
                    font-size: 0.9rem;
                    border: 1px solid rgba(100, 180, 255, 0.2);
                    z-index: 100;
                `;
                hint.innerHTML = 'ğŸ’¡ å¿«æ·é”®:<br>' +
                               'ESC: è¿”å›ä¸»é¡µ<br>' +
                               'Ctrl+â†/â†’: åˆ‡æ¢æ­¥éª¤<br>' +
                               'ç©ºæ ¼: æ‰§è¡Œæ­¥éª¤<br>' +
                               'Ctrl+R: é‡ç½®å®éªŒ';
                document.body.appendChild(hint);
                
                setTimeout(() => hint.remove(), 8000);
            }, 3000);
        });
    </script>
</body>
</html>